<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="#Windows PowerShellCopy Code###########################################################################&#xD;&#xA;#&#xD;&#xA;# NAME: Get-WURebootsOrInstalls.ps1&#xD;&#xA;#&#xD;&#xA;# AUTHOR: John Grenfell&#xD;&#xA;# EMAIL: john.grenfell@wiltshire.ac.uk&#xD;&#xA;#&#xD;&#xA;# COMMENT: Scan your servers for WU status and send an email&#xD;&#xA;#&#xD;&#xA;# &#xD;&#xA;# Replace &quot;OU=Servers,DC=company,DC=com&quot; with the location of your servers&#xD;&#xA;# Replace serveradmin@company.com for who gets the email&#xD;&#xA;# Replace itscript@company.com with a vaild sending address (and make sure your email server accepts smtp fro the host running the script)&#xD;&#xA;#&#xD;&#xA;# You have a royalty-free right to use, modify, reproduce, and&#xD;&#xA;# distribute this script file in any way you find useful, provided that&#xD;&#xA;# you agree that the creator, owner above has no warranty, obligations,&#xD;&#xA;# or liability for such use.&#xD;&#xA;#&#xD;&#xA;# VERSION HISTORY:&#xD;&#xA;# 1.1 19.01.2011 - Beta release&#xD;&#xA;#&#xD;&#xA;#&#xD;&#xA;###########################################################################&#xD;&#xA;&#xD;&#xA;Import-Module ActiveDirectory&#xD;&#xA;&#xD;&#xA;$date = get-date&#xD;&#xA;&#xD;&#xA;$date = $date.GetDateTimeFormats()[4]&#xD;&#xA;&#xD;&#xA;Function Send-Email(){&#xD;&#xA;Param($ToAddress = &quot;.&quot;,$MessageType = &quot;.&quot;,$MessageContent = &quot;.&quot;)&#xD;&#xA;&#xD;&#xA;trap [Exception] { &#xD;&#xA;write-host &quot;Trapped Sending Email to $ToAddress on $server&quot; -ForegroundColor Red&#xD;&#xA;continue}&#xD;&#xA;&#xD;&#xA;    $FromAddress = “itscript@company.com”&#xD;&#xA;    $Subject = &quot;Servers requiring $MessageType&quot;&#xD;&#xA;    $MessageBody = &quot;Hi,&#xD;&#xA;    &lt;p&gt;We have detected a number of servers require $MessageType. Please check $MessageContent&lt;br&gt;&lt;br&gt;&#xD;&#xA;    Kind Regards,&lt;br&gt;&lt;/p&gt;&#xD;&#xA;    ICT Network Services.&quot;&#xD;&#xA;       &#xD;&#xA;    Send-MailMessage -To $ToAddress `&#xD;&#xA;                    -Subject $Subject `&#xD;&#xA;                    -From $FromAddress `&#xD;&#xA;                    -Body $MessageBody `&#xD;&#xA;                    -SmtpServer mail.company.com `&#xD;&#xA;                    -BodyAsHtml&#xD;&#xA;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;$RebootsNeeded = @()&#xD;&#xA;$InstallsPending = @()&#xD;&#xA;&#xD;&#xA;$Servers= Get-ADComputer -Filter * -SearchBase &quot;OU=Servers,DC=company,DC=com&quot;| Select-Object -expandproperty Name&#xD;&#xA;foreach($Server in $servers){&#xD;&#xA;        If (Test-Connection $server -count 1 -quiet){&#xD;&#xA;            Write-Host &quot;Getting Session State for $server&quot;&#xD;&#xA;            If (Test-Path &quot;\\$server\c$\windows\WindowsUpdate.log&quot;){&#xD;&#xA;                Write-Host &quot;Scanning File on $Server&quot;&#xD;&#xA;                $RebootPattern = Get-ChildItem &quot;\\$server\c$\windows\WindowsUpdate.log&quot; | Select-String -Pattern $date | Select-String -Pattern 'Reboot Pending'&#xD;&#xA;                $InstallPattern = Get-ChildItem &quot;\\$server\c$\windows\WindowsUpdate.log&quot; | Select-String -Pattern $date | Select-String -Pattern &quot;AU setting pending client directive to 'Install Approval'&quot;&#xD;&#xA;                Write-Host $RebootPattern&#xD;&#xA;                Write-Host $InstallPattern&#xD;&#xA;                If ($RebootPattern){&#xD;&#xA;                    Write-Host &quot;$Server needs a reboot&quot;&#xD;&#xA;                    $RebootsNeeded = $RebootsNeeded + $Server&#xD;&#xA;                }&#xD;&#xA;                ElseIf ($InstallPattern){&#xD;&#xA;                     Write-Host &quot;$Server requires a WU install&quot;&#xD;&#xA;                    $InstallsPending = $InstallsPending + $Server&#xD;&#xA;                Write-Host &quot;Finished $File&quot;&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;        }&#xD;&#xA;        &#xD;&#xA;} &#xD;&#xA;&#xD;&#xA;$RebootsNeeded | FL&#xD;&#xA;&#xD;&#xA;Send-Email serveradmin@company.com Reboots $RebootsNeeded&#xD;&#xA;&#xD;&#xA;$InstallsPending | FL&#xD;&#xA;&#xD;&#xA;Send-Email serveradmin@company.com Installs $InstallsPending&#xD;&#xA;" />
</CodeSnippets>