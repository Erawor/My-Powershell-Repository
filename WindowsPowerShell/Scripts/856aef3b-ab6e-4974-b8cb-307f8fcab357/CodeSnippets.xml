<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="$service = &quot;wuauserv&quot;&#xD;&#xA;$pclist = &quot;C:\wsusPCerrors.txt&quot;&#xD;&#xA;&#xD;&#xA;foreach ($computername in gc $PClist)&#xD;&#xA;{&#xD;&#xA;&#xD;&#xA;$pcservice = $null&#xD;&#xA;$reg = $null&#xD;&#xA;$regkey = $null&#xD;&#xA;$SDpath = $null&#xD;&#xA;&#xD;&#xA;if (test-connection $computername -quiet -count 1)&#xD;&#xA;    {&#xD;&#xA;    write-host &quot;Processing: &quot;$computername&#xD;&#xA;&#xD;&#xA;    $pcservice = gwmi win32_service -computername $computername -filter &quot;name='$service'&quot;&#xD;&#xA;    $pcservice.stopservice() | out-null; write-host &quot;Stopping $service service.&quot;&#xD;&#xA;&#xD;&#xA;    do {start-sleep -m 250; $pcservice = gwmi win32_service -computername $computername -filter &quot;name='$service'&quot;}&#xD;&#xA;    while ($pcservice.state -eq &quot;Running&quot;)&#xD;&#xA;&#xD;&#xA;    $reg = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey('LocalMachine', $computerName)&#xD;&#xA;    $regKey = $reg.OpenSubKey(&quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate&quot;, $true)&#xD;&#xA;    if ($regkey.getvalue(&quot;SUSclientid&quot;)){$regkey.deletevalue(&quot;SUSclientid&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;SusClientIdValidation&quot;)){$regkey.deletevalue(&quot;SusClientIdValidation&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;PingID&quot;)){$regkey.deletevalue(&quot;PingID&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;AccountDomainSid&quot;)){$regkey.deletevalue(&quot;AccountDomainSid&quot;)}&#xD;&#xA;&#xD;&#xA;    $SDpath = &quot;\\$computername\c$\Windows\SoftwareDistribution.old&quot;&#xD;&#xA;    if (test-path $SDpath){remove-item $SDpath -force}&#xD;&#xA;    rename-item -path \\$computername\c$\Windows\SoftwareDistribution -newname $SDpath&#xD;&#xA;    start-sleep -m 250&#xD;&#xA;    $pcservice.startservice() | out-null; write-host &quot;Starting $service service.&quot;&#xD;&#xA;&#xD;&#xA;    cmd /c PsExec.exe \\$computername -d C:\windows\system32\wuauclt.exe /resetauthorization /detectnow&#xD;&#xA;    }&#xD;&#xA;else{write-host &quot;Could not contact: &quot; $computername}&#xD;&#xA;write-host &quot;##################################################&quot;&#xD;&#xA;} #End foreach $pc" />
  <Code Content="$service = &quot;wuauserv&quot;&#xD;&#xA;$pclist = &quot;C:\wsusPCerrors.txt&quot;&#xD;&#xA;&#xD;&#xA;foreach ($computername in gc $PClist)&#xD;&#xA;{&#xD;&#xA;&#xD;&#xA;$pcservice = $null&#xD;&#xA;$reg = $null&#xD;&#xA;$regkey = $null&#xD;&#xA;$SDpath = $null&#xD;&#xA;&#xD;&#xA;if (test-connection $computername -quiet -count 1)&#xD;&#xA;    {&#xD;&#xA;    write-host &quot;Processing: &quot;$computername&#xD;&#xA;&#xD;&#xA;    $pcservice = gwmi win32_service -computername $computername -filter &quot;name='$service'&quot;&#xD;&#xA;    $pcservice.stopservice() | out-null; write-host &quot;Stopping $service service.&quot;&#xD;&#xA;&#xD;&#xA;    do {start-sleep -m 250; $pcservice = gwmi win32_service -computername $computername -filter &quot;name='$service'&quot;}&#xD;&#xA;    while ($pcservice.state -eq &quot;Running&quot;)&#xD;&#xA;&#xD;&#xA;    $reg = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey('LocalMachine', $computerName)&#xD;&#xA;    $regKey = $reg.OpenSubKey(&quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate&quot;, $true)&#xD;&#xA;    if ($regkey.getvalue(&quot;SUSclientid&quot;)){$regkey.deletevalue(&quot;SUSclientid&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;SusClientIdValidation&quot;)){$regkey.deletevalue(&quot;SusClientIdValidation&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;PingID&quot;)){$regkey.deletevalue(&quot;PingID&quot;)}&#xD;&#xA;    if ($regkey.getvalue(&quot;AccountDomainSid&quot;)){$regkey.deletevalue(&quot;AccountDomainSid&quot;)}&#xD;&#xA;&#xD;&#xA;    $SDpath = &quot;\\$computername\c$\Windows\SoftwareDistribution.old&quot;&#xD;&#xA;    if (test-path $SDpath){remove-item $SDpath -force}&#xD;&#xA;    rename-item -path \\$computername\c$\Windows\SoftwareDistribution -newname $SDpath&#xD;&#xA;    start-sleep -m 250&#xD;&#xA;    $pcservice.startservice() | out-null; write-host &quot;Starting $service service.&quot;&#xD;&#xA;&#xD;&#xA;    cmd /c PsExec.exe \\$computername -d C:\windows\system32\wuauclt.exe /resetauthorization /detectnow&#xD;&#xA;    }&#xD;&#xA;else{write-host &quot;Could not contact: &quot; $computername}&#xD;&#xA;write-host &quot;##################################################&quot;&#xD;&#xA;} #End foreach $pc" />
</CodeSnippets>