<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="# List all downstream servers, run CleanUp and mail report...&#xD;&#xA;$ErrorActionPreference = &quot;SilentlyContinue&quot;;&#xD;&#xA;&#xD;&#xA;$servername = &quot;YourServersName&quot;&#xD;&#xA;$logfile = &quot;C:\TEMP\Report.txt&quot;&#xD;&#xA;$timestamp = Get-Date&#xD;&#xA;$SMTPServer = &quot;smtp-address&quot;&#xD;&#xA;&#xD;&#xA;[reflection.assembly]::LoadWithPartialName(&quot;Microsoft.UpdateServices.Administration&quot;) | out-null&#xD;&#xA;&#xD;&#xA;Write-Output $timestamp | out-File -filepath $logfile;&#xD;&#xA;$wsus = [Microsoft.UpdateServices.Administration.AdminProxy]::GetUpdateServer($servername,0);&#xD;&#xA;$wsus_master = $wsus.GetCleanupManager();&#xD;&#xA;$wsus_depots = $wsus.GetChildServers();&#xD;&#xA;$wsus_depots | foreach-object {&#xD;&#xA;&#x9;$wsus_depot = $_.FullDomainName;&#xD;&#xA;&#x9;$wsus_depot_item = [Microsoft.UpdateServices.Administration.AdminProxy]::GetUpdateServer($wsus_depot,0);&#xD;&#xA;&#x9;$wsus_depot_item.GetSubscription().StartSynchronization();&#xD;&#xA;&#x9;$wsus_depot_cleanup = $wsus_depot_item.GetCleanupManager();&#xD;&#xA;&#x9;$wsus_depot_cleaner = new-object 'Microsoft.UpdateServices.Administration.CleanupScope';&#xD;&#xA;&#x9;$wsus_depot_cleaner.DeclineSupersededUpdates = $True;&#xD;&#xA;&#x9;$wsus_depot_cleaner.DeclineExpiredUpdates = $True;&#xD;&#xA;&#x9;$wsus_depot_cleaner.CleanupObsoleteComputers = $True;&#xD;&#xA;&#x9;$wsus_depot_cleaner.CleanupObsoleteUpdates = $True;&#xD;&#xA;&#x9;$wsus_depot_cleaner.CompressUpdates = $True;&#xD;&#xA;&#x9;$wsus_depot_cleaner.CleanupUnneededContentFiles = $True;&#xD;&#xA;&#x9;Write-Output $wsus_depot_item.ServerName | out-File -filepath $logfile -append;&#xD;&#xA;&#x9;$wsus_depot_cleanup.PerformCleanup($wsus_depot_cleaner) | out-File -filepath $logfile -append;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;# Mail the report...&#xD;&#xA;$message = new-object Net.Mail.MailMessage&#xD;&#xA;$message_attachment = new-object Net.Mail.Attachment($logfile)&#xD;&#xA;$mailer = new-object Net.Mail.SmtpClient($SMTPServer) &#xD;&#xA;&#xD;&#xA;$message.From = &quot;from@domain.com&quot;&#xD;&#xA;$message.To.Add(&quot;to@domain.com&quot;)&#xD;&#xA;$message.Subject = &quot;Windows Update - Server CleanUp Wizard&quot;&#xD;&#xA;$message.Body = &quot;Monthly Report&quot;&#xD;&#xA;$message.Attachments.Add($message_attachment) &#xD;&#xA;&#xD;&#xA;$mailer.Send($message)&#xD;&#xA;" />
</CodeSnippets>