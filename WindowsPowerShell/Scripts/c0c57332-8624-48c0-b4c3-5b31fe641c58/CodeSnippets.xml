<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="IF OBJECT_ID('SP_SearchTables','P') IS NOT NULL&#xD;&#xA;&#x9;DROP PROCEDURE SP_SearchTables&#xD;&#xA;GO&#xD;&#xA;CREATE PROCEDURE SP_SearchTables&#xD;&#xA; @Tablenames VARCHAR(500)&#xD;&#xA;,@SearchStr NVARCHAR(60)&#xD;&#xA;,@GenerateSQLOnly Bit = 0&#xD;&#xA;AS&#xD;&#xA;&#xD;&#xA;/*&#xD;&#xA;&#x9;Parameters and usage&#xD;&#xA;&#xD;&#xA;&#x9;@Tablenames&#x9;&#x9;-- Provide a single table name or multiple table name with comma seperated. &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;If left blank , it will check for all the tables in the database&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Provide wild card tables names with comma seperated&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EX :'%tbl%,Dim%' -- This will search the table having names comtains &quot;tbl&quot; and starts with &quot;Dim&quot;&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;@SearchStr&#x9;&#x9;-- Provide the search string. Use the '%' to coin the search. Also can provide multiple search with comma seperated&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EX : X%--- will give data staring with X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X--- will give data ending with X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%--- will give data containig  X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%,Y%--- will give data containig  X or starting with Y&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%,%,,% -- Use a double comma to search comma in the data&#xD;&#xA;&#x9;@GenerateSQLOnly -- Provide 1 if you only want to generate the SQL statements without seraching the database. &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;By default it is 0 and it will search.&#xD;&#xA;&#xD;&#xA;&#x9;Samples :&#xD;&#xA;&#xD;&#xA;&#x9;1. To search data in a table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = 'T1'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in table T1 with string containing TEST.&#xD;&#xA;&#xD;&#xA;&#x9;2. To search in a multiple table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = 'T2'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in tables T1 &amp; T2 with string containing TEST.&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;3. To search in a all table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = '%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in all table with string containing TEST.&#xD;&#xA;&#xD;&#xA;&#x9;4. Generate the SQL for the Select statements&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= 'T1'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 1&#xD;&#xA;&#xD;&#xA;&#x9;5. To Search in tables with specfic name&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#x9;6. To Search in multiple tables with specfic names&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;7. To specify multiple search strings&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%,TEST1%,%TEST2'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;8. To search comma itself in the tables use double comma &quot;,,&quot;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%,,%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%with,,comma%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;*/&#xD;&#xA;&#xD;&#xA;&#x9;SET NOCOUNT ON&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @MatchFound BIT&#xD;&#xA;&#xD;&#xA;&#x9;SELECT @MatchFound = 0&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @CheckTableNames Table&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9;Tablename sysname&#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SearchStringTbl TABLE&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9;SearchString VARCHAR(500)&#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SQLTbl TABLE&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9; Tablename&#x9;&#x9;SYSNAME&#xD;&#xA;&#x9;,WHEREClause    VARCHAR(MAX)&#xD;&#xA;&#x9;,SQLStatement   VARCHAR(MAX)&#xD;&#xA;&#x9;,Execstatus&#x9;&#x9;BIT &#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SQL VARCHAR(MAX)&#xD;&#xA;&#x9;DECLARE @TblSQL VARCHAR(MAX)&#xD;&#xA;&#x9;DECLARE @tmpTblname sysname&#xD;&#xA;&#x9;DECLARE @ErrMsg VARCHAR(100)&#xD;&#xA;&#xD;&#xA;&#x9;IF LTRIM(RTRIM(@Tablenames)) IN ('' ,'%')&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @CheckTableNames&#xD;&#xA;&#x9;&#x9;SELECT Name&#xD;&#xA;&#x9;&#x9;  FROM sys.tables&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;ELSE&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;IF CHARINDEX(',',@Tablenames) &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + REPLACE(@Tablenames,',','''as TblName UNION SELECT ''') + ''''&#xD;&#xA;&#x9;&#x9;ELSE&#xD;&#xA;&#x9;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + @Tablenames + ''' as TblName '&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @TblSQL = 'SELECT T.NAME&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM SYS.TABLES T&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN (' + @SQL + ') tblsrc&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ON T.name LIKE tblsrc.tblname '&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @CheckTableNames&#xD;&#xA;&#x9;&#x9;EXEC(@TblSQL)&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;IF NOT EXISTS(SELECT 1 FROM @CheckTableNames)&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'No tables are found in this database ' + DB_NAME() + ' for the specified filter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;IF LTRIM(RTRIM(@SearchStr)) =''&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'Please specify the search string in @SearchStr Parameter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;ELSE&#xD;&#xA;&#x9;BEGIN &#xD;&#xA;&#x9;&#x9;SELECT @SearchStr = REPLACE(@SearchStr,',,,',',#DOUBLECOMMA#')&#xD;&#xA;&#x9;&#x9;SELECT @SearchStr = REPLACE(@SearchStr,',,','#DOUBLECOMMA#')&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + REPLACE(@SearchStr,',','''as SearchString UNION SELECT ''') + ''''&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @SearchStringTbl&#xD;&#xA;&#x9;&#x9;(SearchString)&#xD;&#xA;&#x9;&#x9;EXEC(@SQL)&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;UPDATE @SearchStringTbl&#xD;&#xA;&#x9;&#x9;   SET SearchString = REPLACE(SearchString ,'#DOUBLECOMMA#',',')&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;INSERT INTO @SQLTbl&#xD;&#xA;&#x9;( Tablename,WHEREClause)&#xD;&#xA;&#x9;SELECT QUOTENAME(SCh.name) + '.' + QUOTENAME(ST.NAME),&#xD;&#xA;&#x9;&#x9;&#x9;(&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT '[' + SC.Name + ']' + ' LIKE ''' + SearchSTR.SearchString + ''' OR ' + CHAR(10)&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  FROM SYS.columns SC&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  JOIN SYS.types STy&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ON STy.system_type_id = SC.system_type_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;   AND STy.user_type_id =SC.user_type_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  CROSS JOIN @SearchStringTbl SearchSTR&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; WHERE STY.name in ('varchar','char','nvarchar','nchar','text')&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;   AND SC.object_id = ST.object_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; ORDER BY SC.name&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;FOR XML PATH('')&#xD;&#xA;&#x9;&#x9;&#x9;)&#xD;&#xA;&#x9;  FROM  SYS.tables ST&#xD;&#xA;&#x9;  JOIN @CheckTableNames chktbls&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;ON chktbls.Tablename = ST.name &#xD;&#xA;&#x9;  JOIN SYS.schemas SCh&#xD;&#xA;&#x9;    ON ST.schema_id = SCh.schema_id&#xD;&#xA;&#x9; WHERE ST.name &lt;&gt; 'SearchTMP'&#xD;&#xA;      GROUP BY ST.object_id, QUOTENAME(SCh.name) + '.' +  QUOTENAME(ST.NAME) ;&#xD;&#xA;&#x9;&#xD;&#xA;&#xD;&#xA;&#x9;  UPDATE @SQLTbl&#xD;&#xA;&#x9;&#x9; SET SQLStatement = 'SELECT * INTO SearchTMP FROM ' + Tablename + ' WHERE ' + substring(WHEREClause,1,len(WHEREClause)-5)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; &#xD;&#xA;&#x9;  DELETE FROM @SQLTbl&#xD;&#xA;&#x9;   WHERE WHEREClause IS NULL&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;WHILE EXISTS (SELECT 1 FROM @SQLTbl WHERE ISNULL(Execstatus ,0) = 0)&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT TOP 1 @tmpTblname = Tablename , @SQL = SQLStatement&#xD;&#xA;&#x9;&#x9;  FROM @SQLTbl &#xD;&#xA;&#x9;&#x9; WHERE ISNULL(Execstatus ,0) = 0&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; IF @GenerateSQLOnly = 0&#xD;&#xA;&#x9;&#x9; BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#x9;IF OBJECT_ID('SearchTMP','U') IS NOT NULL&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;DROP TABLE SearchTMP&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;&#x9;EXEC (@SQL)&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#x9;IF EXISTS(SELECT 1 FROM SearchTMP)&#xD;&#xA;&#x9;&#x9;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT Tablename=@tmpTblname,* FROM SearchTMP&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT @MatchFound = 1&#xD;&#xA;&#x9;&#x9;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; END&#xD;&#xA;&#x9;&#x9; ELSE&#xD;&#xA;&#x9;&#x9; BEGIN&#xD;&#xA;&#x9;&#x9;&#x9; PRINT REPLICATE('-',100)&#xD;&#xA;&#x9;&#x9;&#x9; PRINT @tmpTblname&#xD;&#xA;&#x9;&#x9;&#x9; PRINT REPLICATE('-',100)&#xD;&#xA;&#x9;&#x9;&#x9; PRINT replace(@SQL,'INTO SearchTMP','')&#xD;&#xA;&#x9;&#x9; END&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; UPDATE @SQLTbl&#xD;&#xA;&#x9;&#x9;    SET Execstatus = 1&#xD;&#xA;&#x9;&#x9;  WHERE Tablename = @tmpTblname&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;IF @MatchFound = 0 &#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'No Matches are found in this database ' + DB_NAME() + ' for the specified filter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;SET NOCOUNT OFF&#xD;&#xA;&#xD;&#xA;go&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;" />
  <Code Content="IF OBJECT_ID('SP_SearchTables','P') IS NOT NULL&#xD;&#xA;&#x9;DROP PROCEDURE SP_SearchTables&#xD;&#xA;GO&#xD;&#xA;CREATE PROCEDURE SP_SearchTables&#xD;&#xA; @Tablenames VARCHAR(500)&#xD;&#xA;,@SearchStr NVARCHAR(60)&#xD;&#xA;,@GenerateSQLOnly Bit = 0&#xD;&#xA;AS&#xD;&#xA;&#xD;&#xA;/*&#xD;&#xA;&#x9;Parameters and usage&#xD;&#xA;&#xD;&#xA;&#x9;@Tablenames&#x9;&#x9;-- Provide a single table name or multiple table name with comma seperated. &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;If left blank , it will check for all the tables in the database&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Provide wild card tables names with comma seperated&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EX :'%tbl%,Dim%' -- This will search the table having names comtains &quot;tbl&quot; and starts with &quot;Dim&quot;&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;@SearchStr&#x9;&#x9;-- Provide the search string. Use the '%' to coin the search. Also can provide multiple search with comma seperated&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;EX : X%--- will give data staring with X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X--- will give data ending with X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%--- will give data containig  X&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%,Y%--- will give data containig  X or starting with Y&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; %X%,%,,% -- Use a double comma to search comma in the data&#xD;&#xA;&#x9;@GenerateSQLOnly -- Provide 1 if you only want to generate the SQL statements without seraching the database. &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;By default it is 0 and it will search.&#xD;&#xA;&#xD;&#xA;&#x9;Samples :&#xD;&#xA;&#xD;&#xA;&#x9;1. To search data in a table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = 'T1'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in table T1 with string containing TEST.&#xD;&#xA;&#xD;&#xA;&#x9;2. To search in a multiple table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = 'T2'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in tables T1 &amp; T2 with string containing TEST.&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;3. To search in a all table&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames = '%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr  = '%TEST%'&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;The above sample searches in all table with string containing TEST.&#xD;&#xA;&#xD;&#xA;&#x9;4. Generate the SQL for the Select statements&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= 'T1'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 1&#xD;&#xA;&#xD;&#xA;&#x9;5. To Search in tables with specfic name&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#x9;6. To Search in multiple tables with specfic names&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;7. To specify multiple search strings&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%TEST%,TEST1%,%TEST2'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;8. To search comma itself in the tables use double comma &quot;,,&quot;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%,,%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;EXEC SP_SearchTables @Tablenames&#x9;&#x9;= '%T1%,Dim%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@SearchStr&#x9;&#x9;= '%with,,comma%'&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ,@GenerateSQLOnly&#x9;= 0&#xD;&#xA;*/&#xD;&#xA;&#xD;&#xA;&#x9;SET NOCOUNT ON&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @MatchFound BIT&#xD;&#xA;&#xD;&#xA;&#x9;SELECT @MatchFound = 0&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @CheckTableNames Table&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9;Tablename sysname&#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SearchStringTbl TABLE&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9;SearchString VARCHAR(500)&#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SQLTbl TABLE&#xD;&#xA;&#x9;(&#xD;&#xA;&#x9; Tablename&#x9;&#x9;SYSNAME&#xD;&#xA;&#x9;,WHEREClause    VARCHAR(MAX)&#xD;&#xA;&#x9;,SQLStatement   VARCHAR(MAX)&#xD;&#xA;&#x9;,Execstatus&#x9;&#x9;BIT &#xD;&#xA;&#x9;)&#xD;&#xA;&#xD;&#xA;&#x9;DECLARE @SQL VARCHAR(MAX)&#xD;&#xA;&#x9;DECLARE @TblSQL VARCHAR(MAX)&#xD;&#xA;&#x9;DECLARE @tmpTblname sysname&#xD;&#xA;&#x9;DECLARE @ErrMsg VARCHAR(100)&#xD;&#xA;&#xD;&#xA;&#x9;IF LTRIM(RTRIM(@Tablenames)) IN ('' ,'%')&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @CheckTableNames&#xD;&#xA;&#x9;&#x9;SELECT Name&#xD;&#xA;&#x9;&#x9;  FROM sys.tables&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;ELSE&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;IF CHARINDEX(',',@Tablenames) &gt; 0 &#xD;&#xA;&#x9;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + REPLACE(@Tablenames,',','''as TblName UNION SELECT ''') + ''''&#xD;&#xA;&#x9;&#x9;ELSE&#xD;&#xA;&#x9;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + @Tablenames + ''' as TblName '&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @TblSQL = 'SELECT T.NAME&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM SYS.TABLES T&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;JOIN (' + @SQL + ') tblsrc&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ON T.name LIKE tblsrc.tblname '&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @CheckTableNames&#xD;&#xA;&#x9;&#x9;EXEC(@TblSQL)&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;IF NOT EXISTS(SELECT 1 FROM @CheckTableNames)&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'No tables are found in this database ' + DB_NAME() + ' for the specified filter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;IF LTRIM(RTRIM(@SearchStr)) =''&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'Please specify the search string in @SearchStr Parameter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;ELSE&#xD;&#xA;&#x9;BEGIN &#xD;&#xA;&#x9;&#x9;SELECT @SearchStr = REPLACE(@SearchStr,',,,',',#DOUBLECOMMA#')&#xD;&#xA;&#x9;&#x9;SELECT @SearchStr = REPLACE(@SearchStr,',,','#DOUBLECOMMA#')&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT @SQL = 'SELECT ''' + REPLACE(@SearchStr,',','''as SearchString UNION SELECT ''') + ''''&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;INSERT INTO @SearchStringTbl&#xD;&#xA;&#x9;&#x9;(SearchString)&#xD;&#xA;&#x9;&#x9;EXEC(@SQL)&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;UPDATE @SearchStringTbl&#xD;&#xA;&#x9;&#x9;   SET SearchString = REPLACE(SearchString ,'#DOUBLECOMMA#',',')&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;INSERT INTO @SQLTbl&#xD;&#xA;&#x9;( Tablename,WHEREClause)&#xD;&#xA;&#x9;SELECT QUOTENAME(SCh.name) + '.' + QUOTENAME(ST.NAME),&#xD;&#xA;&#x9;&#x9;&#x9;(&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT '[' + SC.Name + ']' + ' LIKE ''' + SearchSTR.SearchString + ''' OR ' + CHAR(10)&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  FROM SYS.columns SC&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  JOIN SYS.types STy&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ON STy.system_type_id = SC.system_type_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;   AND STy.user_type_id =SC.user_type_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  CROSS JOIN @SearchStringTbl SearchSTR&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; WHERE STY.name in ('varchar','char','nvarchar','nchar','text')&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;   AND SC.object_id = ST.object_id&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; ORDER BY SC.name&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;FOR XML PATH('')&#xD;&#xA;&#x9;&#x9;&#x9;)&#xD;&#xA;&#x9;  FROM  SYS.tables ST&#xD;&#xA;&#x9;  JOIN @CheckTableNames chktbls&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;ON chktbls.Tablename = ST.name &#xD;&#xA;&#x9;  JOIN SYS.schemas SCh&#xD;&#xA;&#x9;    ON ST.schema_id = SCh.schema_id&#xD;&#xA;&#x9; WHERE ST.name &lt;&gt; 'SearchTMP'&#xD;&#xA;      GROUP BY ST.object_id, QUOTENAME(SCh.name) + '.' +  QUOTENAME(ST.NAME) ;&#xD;&#xA;&#x9;&#xD;&#xA;&#xD;&#xA;&#x9;  UPDATE @SQLTbl&#xD;&#xA;&#x9;&#x9; SET SQLStatement = 'SELECT * INTO SearchTMP FROM ' + Tablename + ' WHERE ' + substring(WHEREClause,1,len(WHEREClause)-5)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; &#xD;&#xA;&#x9;  DELETE FROM @SQLTbl&#xD;&#xA;&#x9;   WHERE WHEREClause IS NULL&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;WHILE EXISTS (SELECT 1 FROM @SQLTbl WHERE ISNULL(Execstatus ,0) = 0)&#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;SELECT TOP 1 @tmpTblname = Tablename , @SQL = SQLStatement&#xD;&#xA;&#x9;&#x9;  FROM @SQLTbl &#xD;&#xA;&#x9;&#x9; WHERE ISNULL(Execstatus ,0) = 0&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; IF @GenerateSQLOnly = 0&#xD;&#xA;&#x9;&#x9; BEGIN&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#x9;IF OBJECT_ID('SearchTMP','U') IS NOT NULL&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;DROP TABLE SearchTMP&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;&#x9;EXEC (@SQL)&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;&#x9;IF EXISTS(SELECT 1 FROM SearchTMP)&#xD;&#xA;&#x9;&#x9;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT Tablename=@tmpTblname,* FROM SearchTMP&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;SELECT @MatchFound = 1&#xD;&#xA;&#x9;&#x9;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; END&#xD;&#xA;&#x9;&#x9; ELSE&#xD;&#xA;&#x9;&#x9; BEGIN&#xD;&#xA;&#x9;&#x9;&#x9; PRINT REPLICATE('-',100)&#xD;&#xA;&#x9;&#x9;&#x9; PRINT @tmpTblname&#xD;&#xA;&#x9;&#x9;&#x9; PRINT REPLICATE('-',100)&#xD;&#xA;&#x9;&#x9;&#x9; PRINT replace(@SQL,'INTO SearchTMP','')&#xD;&#xA;&#x9;&#x9; END&#xD;&#xA;&#xD;&#xA;&#x9;&#x9; UPDATE @SQLTbl&#xD;&#xA;&#x9;&#x9;    SET Execstatus = 1&#xD;&#xA;&#x9;&#x9;  WHERE Tablename = @tmpTblname&#xD;&#xA;&#xD;&#xA;&#x9;END&#xD;&#xA;&#xD;&#xA;&#x9;IF @MatchFound = 0 &#xD;&#xA;&#x9;BEGIN&#xD;&#xA;&#x9;&#x9;SELECT @ErrMsg = 'No Matches are found in this database ' + DB_NAME() + ' for the specified filter'&#xD;&#xA;&#x9;&#x9;PRINT @ErrMsg&#xD;&#xA;&#x9;&#x9;RETURN&#xD;&#xA;&#x9;END&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;SET NOCOUNT OFF&#xD;&#xA;&#xD;&#xA;go&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;" />
</CodeSnippets>